<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste PIX Final - Sistema Corrigido</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 2rem 0; padding: 1rem; border: 2px solid #ddd; border-radius: 8px; }
        .test-approved { border-color: #28a745; background: #f8fff9; }
        .test-blocked { border-color: #dc3545; background: #fff8f8; }
        .test-pending { border-color: #ffc107; background: #fffbf0; }
        button { background: #007bff; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 4px; cursor: pointer; margin: 0.5rem; }
        button:hover { background: #0056b3; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }
        pre { background: #f8f9fa; padding: 1rem; border-radius: 4px; overflow-x: auto; }
        .status { font-weight: bold; padding: 0.3rem 0.8rem; border-radius: 4px; }
        .status-success { background: #d4edda; color: #155724; }
        .status-danger { background: #f8d7da; color: #721c24; }
        .status-warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Teste Final - Sistema PIX/Den√∫ncia Corrigido</h1>
        
        <div class="test-section test-approved">
            <h2>‚úÖ Teste 1: PIX Aprovado (Score Alto)</h2>
            <p><strong>Cen√°rio:</strong> PIX para conta com score alto (baixo risco)</p>
            <p><strong>Chave PIX:</strong> 23456789012 (Maria - Score 77)</p>
            <p><strong>Valor:</strong> R$ 50,00</p>
            <p><strong>Resultado Esperado:</strong> Modal PIX Sucesso</p>
            <button onclick="testarPixAprovado()">üöÄ Testar PIX Aprovado</button>
            <div id="resultado1"></div>
        </div>

        <div class="test-section test-blocked">
            <h2>üö´ Teste 2: PIX Bloqueado (Score Cr√≠tico)</h2>
            <p><strong>Cen√°rio:</strong> PIX para conta com score cr√≠tico (alto risco)</p>
            <p><strong>Chave PIX:</strong> 56789012345 (Carlos - Score 25)</p>
            <p><strong>Valor:</strong> R$ 777,00</p>
            <p><strong>Resultado Esperado:</strong> Modal Transa√ß√£o Bloqueada</p>
            <button onclick="testarPixBloqueado()" class="btn-danger">üõ°Ô∏è Testar PIX Bloqueado</button>
            <div id="resultado2"></div>
        </div>

        <div class="test-section test-pending">
            <h2>üìã Teste 3: Den√∫ncia Manual</h2>
            <p><strong>Cen√°rio:</strong> Criar den√∫ncia manual ap√≥s transa√ß√£o bloqueada</p>
            <p><strong>Resultado Esperado:</strong> Modal Den√∫ncia Enviada</p>
            <button onclick="testarDenunciaManual()" class="btn-success">üìã Testar Den√∫ncia</button>
            <div id="resultado3"></div>
        </div>

        <h2>üìä Resultados dos Testes</h2>
        <div id="resultadosGerais"></div>
    </div>

    <script>
        let testesRealizados = 0;
        let testesAprovados = 0;

        async function testarPixAprovado() {
            const resultado = document.getElementById('resultado1');
            resultado.innerHTML = '<p>üîÑ Testando PIX aprovado...</p>';
            
            try {
                // Simular dados de PIX aprovado
                const dadosProcessamento = {
                    contaOrigemId: "1",
                    contaDestinoId: "2", 
                    valor: "50.00",
                    descricao: "Teste PIX Aprovado"
                };

                const response = await fetch('http://localhost:8080/api/pix/processar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(dadosProcessamento)
                });

                const result = await response.json();
                
                testesRealizados++;
                
                if (result.sucesso && result.status !== 'BLOQUEADA') {
                    testesAprovados++;
                    resultado.innerHTML = `
                        <div class="status status-success">‚úÖ TESTE APROVADO</div>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                        <p><strong>‚úÖ Modal correto:</strong> PIX Sucesso exibido</p>
                    `;
                } else {
                    resultado.innerHTML = `
                        <div class="status status-danger">‚ùå TESTE FALHOU</div>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                        <p><strong>‚ùå Erro:</strong> PIX deveria ter sido aprovado</p>
                    `;
                }
            } catch (error) {
                resultado.innerHTML = `
                    <div class="status status-danger">‚ùå ERRO DE CONEX√ÉO</div>
                    <p>${error.message}</p>
                `;
            }
            
            atualizarResultadosGerais();
        }

        async function testarPixBloqueado() {
            const resultado = document.getElementById('resultado2');
            resultado.innerHTML = '<p>üîÑ Testando PIX bloqueado...</p>';
            
            try {
                const dadosProcessamento = {
                    contaOrigemId: "1",
                    contaDestinoId: "5", // Carlos - Score 25 (cr√≠tico)
                    valor: "777.00",
                    descricao: "Teste PIX Bloqueado"
                };

                const response = await fetch('http://localhost:8080/api/pix/processar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(dadosProcessamento)
                });

                const result = await response.json();
                
                testesRealizados++;
                
                if (result.sucesso && result.status === 'BLOQUEADA') {
                    testesAprovados++;
                    resultado.innerHTML = `
                        <div class="status status-success">‚úÖ TESTE APROVADO</div>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                        <p><strong>‚úÖ Modal correto:</strong> Transa√ß√£o Bloqueada exibida</p>
                        ${result.protocoloDenuncia ? `<p><strong>üìã Protocolo:</strong> ${result.protocoloDenuncia}</p>` : ''}
                    `;
                } else {
                    resultado.innerHTML = `
                        <div class="status status-danger">‚ùå TESTE FALHOU</div>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                        <p><strong>‚ùå Erro:</strong> PIX deveria ter sido bloqueado</p>
                    `;
                }
            } catch (error) {
                resultado.innerHTML = `
                    <div class="status status-danger">‚ùå ERRO DE CONEX√ÉO</div>
                    <p>${error.message}</p>
                `;
            }
            
            atualizarResultadosGerais();
        }

        async function testarDenunciaManual() {
            const resultado = document.getElementById('resultado3');
            resultado.innerHTML = '<p>üîÑ Testando den√∫ncia manual...</p>';
            
            try {
                const dadosDenuncia = {
                    tipoTransacao: 'PIX',
                    contaId: '5',
                    valorTransacao: '777.00',
                    motivoDenuncia: 'Teste de den√∫ncia manual via interface corrigida - transa√ß√£o suspeita com valor elevado',
                    evidencias: 'whatsapp, sms',
                    denunciante: 'Cliente via Teste Automatizado'
                };

                const response = await fetch('http://localhost:8080/api/denuncias/manual', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(dadosDenuncia)
                });

                const result = await response.json();
                
                testesRealizados++;
                
                if (result.success) {
                    testesAprovados++;
                    resultado.innerHTML = `
                        <div class="status status-success">‚úÖ TESTE APROVADO</div>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                        <p><strong>‚úÖ Modal correto:</strong> Den√∫ncia Enviada exibida</p>
                    `;
                } else {
                    resultado.innerHTML = `
                        <div class="status status-danger">‚ùå TESTE FALHOU</div>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                        <p><strong>‚ùå Erro:</strong> Den√∫ncia n√£o foi criada</p>
                    `;
                }
            } catch (error) {
                resultado.innerHTML = `
                    <div class="status status-danger">‚ùå ERRO DE CONEX√ÉO</div>
                    <p>${error.message}</p>
                `;
            }
            
            atualizarResultadosGerais();
        }

        function atualizarResultadosGerais() {
            const div = document.getElementById('resultadosGerais');
            const percentual = testesRealizados > 0 ? Math.round((testesAprovados / testesRealizados) * 100) : 0;
            
            let statusClass = 'status-warning';
            let emoji = '‚ö†Ô∏è';
            
            if (percentual === 100) {
                statusClass = 'status-success';
                emoji = '‚úÖ';
            } else if (percentual === 0 && testesRealizados > 0) {
                statusClass = 'status-danger';
                emoji = '‚ùå';
            }
            
            div.innerHTML = `
                <div class="status ${statusClass}">
                    ${emoji} ${testesAprovados}/${testesRealizados} testes aprovados (${percentual}%)
                </div>
                ${testesRealizados === 3 && testesAprovados === 3 ? 
                    '<p><strong>üéâ SISTEMA TOTALMENTE FUNCIONAL!</strong> Todos os problemas foram corrigidos.</p>' : 
                    testesRealizados > 0 ? '<p>Continue testando para validar todas as funcionalidades.</p>' : ''
                }
            `;
        }

        // Teste autom√°tico na inicializa√ß√£o
        window.onload = function() {
            console.log('üîß Sistema de teste PIX/Den√∫ncia carregado');
            console.log('üìã Execute os testes para validar as corre√ß√µes');
        };
    </script>
</body>
</html> 